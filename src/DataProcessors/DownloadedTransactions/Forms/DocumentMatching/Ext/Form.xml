<?xml version="1.0" encoding="UTF-8"?>
<Form xmlns="http://v8.1c.ru/8.3/xcf/logform" xmlns:app="http://v8.1c.ru/8.2/managed-application/core" xmlns:cfg="http://v8.1c.ru/8.1/data/enterprise/current-config" xmlns:dcscor="http://v8.1c.ru/8.1/data-composition-system/core" xmlns:dcsset="http://v8.1c.ru/8.1/data-composition-system/settings" xmlns:ent="http://v8.1c.ru/8.1/data/enterprise" xmlns:lf="http://v8.1c.ru/8.2/managed-application/logform" xmlns:style="http://v8.1c.ru/8.1/data/ui/style" xmlns:sys="http://v8.1c.ru/8.1/data/ui/fonts/system" xmlns:v8="http://v8.1c.ru/8.1/data/core" xmlns:v8ui="http://v8.1c.ru/8.1/data/ui" xmlns:web="http://v8.1c.ru/8.1/data/ui/colors/web" xmlns:win="http://v8.1c.ru/8.1/data/ui/colors/windows" xmlns:xr="http://v8.1c.ru/8.3/xcf/readable" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" version="2.2">
	<Title>
		<v8:item>
			<v8:lang>en</v8:lang>
			<v8:content>Matching transactions</v8:content>
		</v8:item>
	</Title>
	<WindowOpeningMode>LockOwnerWindow</WindowOpeningMode>
	<AutoTitle>false</AutoTitle>
	<AutoCommandBar name="FormCommandBar" id="-1">
		<Autofill>false</Autofill>
	</AutoCommandBar>
	<Events>
		<Event name="OnCreateAtServer">OnCreateAtServer</Event>
	</Events>
	<ChildItems>
		<UsualGroup name="CommandBarGroup" id="49">
			<Title>
				<v8:item>
					<v8:lang>en</v8:lang>
					<v8:content>Command bar group</v8:content>
				</v8:item>
			</Title>
			<ToolTip>
				<v8:item>
					<v8:lang>en</v8:lang>
					<v8:content>Command bar group</v8:content>
				</v8:item>
			</ToolTip>
			<Group>Horizontal</Group>
			<ShowTitle>false</ShowTitle>
			<ExtendedTooltip name="CommandBarGroupExtendedTooltip" id="50"/>
			<ChildItems>
				<Button name="DocumentListButton1" id="29">
					<Type>UsualButton</Type>
					<CommandName>Form.Command.SelectCommand</CommandName>
					<Title>
						<v8:item>
							<v8:lang>en</v8:lang>
							<v8:content>Choose...</v8:content>
						</v8:item>
					</Title>
					<ExtendedTooltip name="DocumentListButton1ExtendedTooltip" id="30"/>
				</Button>
				<CommandBar name="DocumentListGroup1" id="33">
					<ExtendedTooltip name="DocumentListGroup1ExtendedTooltip" id="34"/>
					<ChildItems>
						<Button name="DocumentListButton2" id="31">
							<Type>CommandBarButton</Type>
							<Representation>PictureAndText</Representation>
							<CommandName>Form.Item.DocumentList.StandardCommand.Find</CommandName>
							<ExtendedTooltip name="DocumentListButton2ExtendedTooltip" id="32"/>
						</Button>
						<Button name="DocumentListButton3" id="35">
							<Type>CommandBarButton</Type>
							<Representation>PictureAndText</Representation>
							<CommandName>Form.Item.DocumentList.StandardCommand.CancelSearch</CommandName>
							<ExtendedTooltip name="DocumentListButton3ExtendedTooltip" id="36"/>
						</Button>
					</ChildItems>
				</CommandBar>
				<RadioButtonField name="DateFilter" id="51">
					<DataPath>DateFilter</DataPath>
					<RadioButtonType>Tumbler</RadioButtonType>
					<ChoiceList>
						<xr:Item>
							<xr:Presentation/>
							<xr:CheckState>0</xr:CheckState>
							<xr:Value xsi:type="FormChoiceListDesTimeValue">
								<Presentation>
									<v8:item>
										<v8:lang>en</v8:lang>
										<v8:content>Enable</v8:content>
									</v8:item>
								</Presentation>
								<Value xsi:type="xs:decimal">0</Value>
							</xr:Value>
						</xr:Item>
						<xr:Item>
							<xr:Presentation/>
							<xr:CheckState>0</xr:CheckState>
							<xr:Value xsi:type="FormChoiceListDesTimeValue">
								<Presentation>
									<v8:item>
										<v8:lang>en</v8:lang>
										<v8:content>Disable</v8:content>
									</v8:item>
								</Presentation>
								<Value xsi:type="xs:decimal">1</Value>
							</xr:Value>
						</xr:Item>
					</ChoiceList>
					<Font ref="sys:DefaultGUIFont" bold="true" italic="false" underline="false" strikeout="false" kind="WindowsFont"/>
					<ContextMenu name="DateFilterContextMenu" id="52"/>
					<ExtendedTooltip name="DateFilterExtendedTooltip" id="53"/>
					<Events>
						<Event name="OnChange">DateFilterOnChange</Event>
					</Events>
				</RadioButtonField>
			</ChildItems>
		</UsualGroup>
		<Table name="DocumentList" id="1">
			<UseAlternationRowColor>true</UseAlternationRowColor>
			<EnableStartDrag>true</EnableStartDrag>
			<DataPath>DocumentList</DataPath>
			<RowPictureDataPath>DocumentList.DefaultPicture</RowPictureDataPath>
			<SearchStringLocation>None</SearchStringLocation>
			<ViewStatusLocation>None</ViewStatusLocation>
			<SearchControlLocation>None</SearchControlLocation>
			<AutoRefresh>false</AutoRefresh>
			<AutoRefreshPeriod>60</AutoRefreshPeriod>
			<Period>
				<v8:variant xsi:type="v8:StandardPeriodVariant">Custom</v8:variant>
				<v8:startDate>0001-01-01T00:00:00</v8:startDate>
				<v8:endDate>0001-01-01T00:00:00</v8:endDate>
			</Period>
			<ChoiceFoldersAndItems>Items</ChoiceFoldersAndItems>
			<RestoreCurrentRow>false</RestoreCurrentRow>
			<TopLevelParent xsi:nil="true"/>
			<ShowRoot>true</ShowRoot>
			<AllowRootChoice>false</AllowRootChoice>
			<UpdateOnDataChange>Auto</UpdateOnDataChange>
			<ContextMenu name="DocumentListContextMenu" id="2"/>
			<AutoCommandBar name="DocumentListCommandBar" id="3">
				<Autofill>false</Autofill>
			</AutoCommandBar>
			<ExtendedTooltip name="DocumentListExtendedTooltip" id="4"/>
			<SearchStringAddition name="DocumentListSearchString" id="40">
				<AdditionSource>
					<Item>DocumentList</Item>
					<Type>SearchStringRepresentation</Type>
				</AdditionSource>
				<ContextMenu name="DocumentListSearchStringContextMenu" id="41"/>
				<ExtendedTooltip name="DocumentListSearchStringExtendedTooltip" id="42"/>
			</SearchStringAddition>
			<ViewStatusAddition name="DocumentListViewStatus" id="43">
				<AdditionSource>
					<Item>DocumentList</Item>
					<Type>ViewStatusRepresentation</Type>
				</AdditionSource>
				<ContextMenu name="DocumentListViewStatusContextMenu" id="44"/>
				<ExtendedTooltip name="DocumentListViewStatusExtendedTooltip" id="45"/>
			</ViewStatusAddition>
			<SearchControlAddition name="DocumentListSearchControl" id="46">
				<AdditionSource>
					<Item>DocumentList</Item>
					<Type>SearchControl</Type>
				</AdditionSource>
				<ContextMenu name="DocumentListSearchControlContextMenu" id="47"/>
				<ExtendedTooltip name="DocumentListSearchControlExtendedTooltip" id="48"/>
			</SearchControlAddition>
			<Events>
				<Event name="Selection">DocumentListSelection</Event>
			</Events>
			<ChildItems>
				<LabelField name="DocumentListDate" id="5">
					<DataPath>DocumentList.Date</DataPath>
					<Width>4</Width>
					<ContextMenu name="DocumentListDateContextMenu" id="6"/>
					<ExtendedTooltip name="DocumentListDateExtendedTooltip" id="7"/>
				</LabelField>
				<LabelField name="DocumentListNumber" id="8">
					<DataPath>DocumentList.Number</DataPath>
					<Width>10</Width>
					<ContextMenu name="DocumentListNumberContextMenu" id="9"/>
					<ExtendedTooltip name="DocumentListNumberExtendedTooltip" id="10"/>
				</LabelField>
				<LabelField name="DocumentListType" id="11">
					<DataPath>DocumentList.Type</DataPath>
					<Width>15</Width>
					<ContextMenu name="DocumentListTypeContextMenu" id="12"/>
					<ExtendedTooltip name="DocumentListTypeExtendedTooltip" id="13"/>
				</LabelField>
				<LabelField name="DocumentListTotal" id="14">
					<DataPath>DocumentList.Total</DataPath>
					<Width>10</Width>
					<ContextMenu name="DocumentListTotalContextMenu" id="15"/>
					<ExtendedTooltip name="DocumentListTotalExtendedTooltip" id="16"/>
				</LabelField>
				<LabelField name="DocumentListCompany" id="20">
					<DataPath>DocumentList.Company</DataPath>
					<ContextMenu name="DocumentListCompanyContextMenu" id="21"/>
					<ExtendedTooltip name="DocumentListCompanyExtendedTooltip" id="22"/>
				</LabelField>
				<LabelField name="DocumentListMemo" id="17">
					<DataPath>DocumentList.Memo</DataPath>
					<ContextMenu name="DocumentListMemoContextMenu" id="18"/>
					<ExtendedTooltip name="DocumentListMemoExtendedTooltip" id="19"/>
				</LabelField>
				<LabelField name="DocumentListDueDate" id="23">
					<DataPath>DocumentList.DueDate</DataPath>
					<Width>6</Width>
					<ContextMenu name="DocumentListDueDateContextMenu" id="24"/>
					<ExtendedTooltip name="DocumentListDueDateExtendedTooltip" id="25"/>
				</LabelField>
				<LabelField name="DocumentListProject" id="26">
					<DataPath>DocumentList.Project</DataPath>
					<ContextMenu name="DocumentListProjectContextMenu" id="27"/>
					<ExtendedTooltip name="DocumentListProjectExtendedTooltip" id="28"/>
				</LabelField>
				<LabelField name="DocumentListRef" id="37">
					<DataPath>DocumentList.Ref</DataPath>
					<Visible>false</Visible>
					<ContextMenu name="DocumentListRefContextMenu" id="38"/>
					<ExtendedTooltip name="DocumentListRefExtendedTooltip" id="39"/>
				</LabelField>
			</ChildItems>
		</Table>
	</ChildItems>
	<Attributes>
		<Attribute name="Object" id="1">
			<Type>
				<v8:Type>cfg:DataProcessorObject.DownloadedTransactions</v8:Type>
			</Type>
			<MainAttribute>true</MainAttribute>
		</Attribute>
		<Attribute name="DocumentList" id="2">
			<Title>
				<v8:item>
					<v8:lang>en</v8:lang>
					<v8:content>Document list</v8:content>
				</v8:item>
			</Title>
			<Type>
				<v8:Type>cfg:DynamicList</v8:Type>
			</Type>
			<UseAlways>
				<Field>DocumentList.Ref</Field>
			</UseAlways>
			<Settings xsi:type="DynamicList">
				<ManualQuery>true</ManualQuery>
				<DynamicDataRead>false</DynamicDataRead>
				<QueryText>SELECT
	DocumentJournalDocumentJournal1.Ref,
	DocumentJournalDocumentJournal1.Date,
	DocumentJournalDocumentJournal1.DeletionMark,
	DocumentJournalDocumentJournal1.Number,
	DocumentJournalDocumentJournal1.Posted,
	DocumentJournalDocumentJournal1.Total,
	DocumentJournalDocumentJournal1.Memo,
	DocumentJournalDocumentJournal1.Company,
	DocumentJournalDocumentJournal1.DueDate,
	DocumentJournalDocumentJournal1.Project,
	DocumentJournalDocumentJournal1.Type
FROM
	DocumentJournal.DocumentJournal1 AS DocumentJournalDocumentJournal1
		LEFT JOIN InformationRegister.BankTransactions AS BankTransactions
		ON DocumentJournalDocumentJournal1.Ref = BankTransactions.Document
WHERE
	DocumentJournalDocumentJournal1.Type IN(&amp;ListWithoutTransfersAndJE)
	AND (DocumentJournalDocumentJournal1.Date BETWEEN &amp;PeriodStart AND &amp;PeriodEnd
			OR NOT &amp;DateFilter)
	AND DocumentJournalDocumentJournal1.Total = &amp;Amount
	AND (BankTransactions.Document IS NULL 
			OR BankTransactions.ID = &amp;TransactionID)
	AND DocumentJournalDocumentJournal1.BankAccount = &amp;BankAccount

UNION ALL

SELECT
	DocumentJournal1.Ref,
	DocumentJournal1.Date,
	DocumentJournal1.DeletionMark,
	DocumentJournal1.Number,
	DocumentJournal1.Posted,
	DocumentJournal1.Total,
	DocumentJournal1.Memo,
	DocumentJournal1.Company,
	DocumentJournal1.DueDate,
	DocumentJournal1.Project,
	DocumentJournal1.Type
FROM
	DocumentJournal.DocumentJournal1 AS DocumentJournal1
		INNER JOIN (SELECT
			BankTransfer.Ref AS Ref
		FROM
			Document.BankTransfer AS BankTransfer
				LEFT JOIN InformationRegister.BankTransactions AS BankTransactions
				ON BankTransfer.Ref = BankTransactions.Document
					AND (BankTransactions.BankAccount = &amp;AccountInBank)
		WHERE
			(BankTransfer.Date BETWEEN &amp;PeriodStart AND &amp;PeriodEnd
					OR NOT &amp;DateFilter)
			AND CASE
					WHEN &amp;IncomingPayment
						THEN BankTransfer.AccountTo = &amp;BankAccount
					ELSE BankTransfer.AccountFrom = &amp;BankAccount
				END
			AND (BankTransactions.Document IS NULL 
					OR BankTransactions.ID = &amp;TransactionID)) AS BankTransfers
		ON DocumentJournal1.Ref = BankTransfers.Ref
WHERE
	DocumentJournal1.Type IN(&amp;ListOfDocumentTypes)
	AND DocumentJournal1.Total = &amp;Amount

UNION ALL

SELECT
	DocumentJournal1.Ref,
	DocumentJournal1.Date,
	DocumentJournal1.DeletionMark,
	DocumentJournal1.Number,
	DocumentJournal1.Posted,
	NestedSelect.Amount,
	DocumentJournal1.Memo,
	DocumentJournal1.Company,
	DocumentJournal1.DueDate,
	DocumentJournal1.Project,
	DocumentJournal1.Type
FROM
	DocumentJournal.DocumentJournal1 AS DocumentJournal1
		INNER JOIN (SELECT
			GeneralJournalTurnovers.Recorder AS Recorder,
			CASE
				WHEN &amp;IncomingPayment
					THEN GeneralJournalTurnovers.AmountRCTurnoverDr
				ELSE GeneralJournalTurnovers.AmountRCTurnoverCr
			END AS Amount
		FROM
			AccountingRegister.GeneralJournal.Turnovers(&amp;PeriodStart, &amp;PeriodEnd, Recorder, Account = &amp;BankAccount, , ) AS GeneralJournalTurnovers
				LEFT JOIN InformationRegister.BankTransactions AS BankTransactions
				ON GeneralJournalTurnovers.Recorder = BankTransactions.Document
					AND (BankTransactions.BankAccount = &amp;AccountInBank)
		WHERE
			CASE
					WHEN &amp;IncomingPayment
						THEN GeneralJournalTurnovers.AmountRCTurnoverDr = &amp;Amount
					ELSE GeneralJournalTurnovers.AmountRCTurnoverCr = &amp;Amount
				END
			AND (BankTransactions.Document IS NULL 
					OR BankTransactions.ID = &amp;TransactionID)
			AND GeneralJournalTurnovers.Recorder REFS Document.GeneralJournalEntry) AS NestedSelect
		ON DocumentJournal1.Ref = NestedSelect.Recorder
WHERE
	DocumentJournal1.Type IN(&amp;ListOfDocumentTypes)

UNION ALL

SELECT
	DocumentJournal1.Ref,
	DocumentJournal1.Date,
	DocumentJournal1.DeletionMark,
	DocumentJournal1.Number,
	DocumentJournal1.Posted,
	NestedSelect.AmountBalance,
	DocumentJournal1.Memo,
	DocumentJournal1.Company,
	DocumentJournal1.DueDate,
	DocumentJournal1.Project,
	DocumentJournal1.Type
FROM
	DocumentJournal.DocumentJournal1 AS DocumentJournal1
		INNER JOIN (SELECT
			GeneralJournalBalance.AmountRCBalanceDr AS AmountBalance,
			GeneralJournalBalance.ExtDimension1.Ref AS ExtDimension1Ref
		FROM
			AccountingRegister.GeneralJournal.Balance(
					,
					,
					&amp;DocumentExtD,
					ExtDimension1 IN
						(SELECT
							SalesInvoice.Ref
						FROM
							Document.SalesInvoice AS SalesInvoice
						WHERE
							SalesInvoice.Posted = TRUE
							AND (SalesInvoice.Date &gt;= &amp;PeriodStart
									AND SalesInvoice.Date &lt;= &amp;PeriodEnd
								OR NOT &amp;DateFilter))) AS GeneralJournalBalance
		WHERE
			GeneralJournalBalance.AmountRCBalanceDr &gt;= &amp;Amount
			AND &amp;IncomingPayment) AS NestedSelect
		ON DocumentJournal1.Ref = NestedSelect.ExtDimension1Ref

UNION ALL

SELECT
	DocumentJournal1.Ref,
	DocumentJournal1.Date,
	DocumentJournal1.DeletionMark,
	DocumentJournal1.Number,
	DocumentJournal1.Posted,
	NestedSelect.AmountBalance,
	DocumentJournal1.Memo,
	DocumentJournal1.Company,
	DocumentJournal1.DueDate,
	DocumentJournal1.Project,
	DocumentJournal1.Type
FROM
	DocumentJournal.DocumentJournal1 AS DocumentJournal1
		INNER JOIN (SELECT
			GeneralJournalBalance.AmountRCBalanceCr AS AmountBalance,
			GeneralJournalBalance.ExtDimension1.Ref AS ExtDimension1Ref
		FROM
			AccountingRegister.GeneralJournal.Balance(
					,
					,
					&amp;DocumentExtD,
					ExtDimension1 IN
						(SELECT
							PurchaseInvoice.Ref
						FROM
							Document.PurchaseInvoice AS PurchaseInvoice
						WHERE
							PurchaseInvoice.Posted = TRUE
							AND (PurchaseInvoice.Date &gt;= &amp;PeriodStart
									AND PurchaseInvoice.Date &lt;= &amp;PeriodEnd
								OR NOT &amp;DateFilter))) AS GeneralJournalBalance
		WHERE
			GeneralJournalBalance.AmountRCBalanceCr &gt;= &amp;Amount
			AND NOT &amp;IncomingPayment) AS NestedSelect
		ON DocumentJournal1.Ref = NestedSelect.ExtDimension1Ref</QueryText>
				<ListSettings>
					<dcsset:filter>
						<dcsset:viewMode>Normal</dcsset:viewMode>
						<dcsset:userSettingID>dfcece9d-5077-440b-b6b3-45a5cb4538eb</dcsset:userSettingID>
					</dcsset:filter>
					<dcsset:order>
						<dcsset:viewMode>Normal</dcsset:viewMode>
						<dcsset:userSettingID>88619765-ccb3-46c6-ac52-38e9c992ebd4</dcsset:userSettingID>
					</dcsset:order>
					<dcsset:conditionalAppearance>
						<dcsset:viewMode>Normal</dcsset:viewMode>
						<dcsset:userSettingID>b75fecce-942b-4aed-abc9-e6a02e460fb3</dcsset:userSettingID>
					</dcsset:conditionalAppearance>
					<dcsset:itemsViewMode>Normal</dcsset:itemsViewMode>
					<dcsset:itemsUserSettingID>911b6018-f537-43e8-a417-da56b22f9aec</dcsset:itemsUserSettingID>
				</ListSettings>
			</Settings>
		</Attribute>
		<Attribute name="DateFilter" id="3">
			<Title>
				<v8:item>
					<v8:lang>en</v8:lang>
					<v8:content>Date filter</v8:content>
				</v8:item>
			</Title>
			<Type>
				<v8:Type>xs:decimal</v8:Type>
				<v8:NumberQualifiers>
					<v8:Digits>1</v8:Digits>
					<v8:FractionDigits>0</v8:FractionDigits>
					<v8:AllowedSign>Nonnegative</v8:AllowedSign>
				</v8:NumberQualifiers>
			</Type>
		</Attribute>
		<Attribute name="TransactionDate" id="4">
			<Title>
				<v8:item>
					<v8:lang>en</v8:lang>
					<v8:content>Transaction date</v8:content>
				</v8:item>
			</Title>
			<Type>
				<v8:Type>xs:dateTime</v8:Type>
				<v8:DateQualifiers>
					<v8:DateFractions>Date</v8:DateFractions>
				</v8:DateQualifiers>
			</Type>
		</Attribute>
	</Attributes>
	<Commands>
		<Command name="SelectCommand" id="1">
			<Title>
				<v8:item>
					<v8:lang>en</v8:lang>
					<v8:content>Select command</v8:content>
				</v8:item>
			</Title>
			<ToolTip>
				<v8:item>
					<v8:lang>en</v8:lang>
					<v8:content>Select command</v8:content>
				</v8:item>
			</ToolTip>
			<Picture>
				<xr:Ref>StdPicture.ChooseValue</xr:Ref>
				<xr:LoadTransparent>true</xr:LoadTransparent>
			</Picture>
			<Action>SelectCommand</Action>
			<Representation>TextPicture</Representation>
		</Command>
	</Commands>
	<Parameters>
		<Parameter name="TransactionDate">
			<Type>
				<v8:Type>xs:dateTime</v8:Type>
				<v8:DateQualifiers>
					<v8:DateFractions>Date</v8:DateFractions>
				</v8:DateQualifiers>
			</Type>
		</Parameter>
		<Parameter name="BankAccount">
			<Type>
				<v8:Type>cfg:ChartOfAccountsRef.ChartOfAccounts</v8:Type>
			</Type>
		</Parameter>
		<Parameter name="ListOfDocumentTypes">
			<Type>
				<v8:Type>v8:ValueListType</v8:Type>
			</Type>
		</Parameter>
		<Parameter name="Amount">
			<Type>
				<v8:Type>xs:decimal</v8:Type>
				<v8:NumberQualifiers>
					<v8:Digits>15</v8:Digits>
					<v8:FractionDigits>2</v8:FractionDigits>
					<v8:AllowedSign>Any</v8:AllowedSign>
				</v8:NumberQualifiers>
			</Type>
		</Parameter>
		<Parameter name="IncomingPayment">
			<Type>
				<v8:Type>xs:boolean</v8:Type>
			</Type>
		</Parameter>
		<Parameter name="AccountInBank">
			<Type>
				<v8:Type>cfg:CatalogRef.BankAccounts</v8:Type>
			</Type>
		</Parameter>
		<Parameter name="TransactionID">
			<Type>
				<v8:Type>v8:UUID</v8:Type>
			</Type>
		</Parameter>
	</Parameters>
</Form>